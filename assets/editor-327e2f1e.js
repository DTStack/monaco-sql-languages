var E=Object.defineProperty;var G=(d,t,e)=>t in d?E(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var v=(d,t,e)=>(G(d,typeof t!="symbol"?t+"":t,e),e);import{B as O,E as x,s as n,x as o,y as T,z as M,F as D,i as _,e as S}from"./index-09b6a538.js";import{i as f}from"./isUndefined-aa0326a0.js";var j=Object.defineProperty,y=Object.getOwnPropertyDescriptor,P=(d,t,e,s)=>{for(var i=s>1?void 0:s?y(t,e):t,r=d.length-1,c;r>=0;r--)(c=d[r])&&(i=(s?c(t,e,i):c(i))||i);return s&&i&&j(t,e,i),i},R=(d,t)=>(e,s)=>t(e,s,d);let I=class extends O{constructor(t){super("editor");v(this,"state");this.keyboardFocus=t,this.state=new x}getToolbars(){return this.getState().toolbar}getCurrent(){return this.getState().current}getGroups(){return this.getState().groups}getToolbar(t){return this.getToolbars().find(n(t))}getGroup(t){if(!f(t))return this.getGroups().find(n(t))}getCurrentGroup(){return this.getGroup(this.getCurrent())}getTabs(t){var e;return((e=this.getGroup(t))==null?void 0:e.data)||[]}getCurrentTabs(){return this.getTabs(this.getCurrent())}getTab(t,e){if(!(f(e)||f(t)))return this.getTabs(e).find(n(t))}getCurrentTab(){var t;return this.getTab((t=this.getCurrentGroup())==null?void 0:t.activeTab,this.getCurrent())}getOptions(){return this.getState().options}updateOptions(t){this.dispatch(e=>{Object.assign(e.options,t)})}setOptions(t){this.dispatch(e=>{e.options=t})}setEntry(t){this.dispatch(e=>{e.entry=t})}updateTab(t,e){this.dispatch(s=>{var r;const i=(r=s.groups.find(n(e)))==null?void 0:r.data.find(n(t.id));i&&(Object.assign(i,t),Object.hasOwn(t,"value")&&(Array.isArray(t.value)?i.diffEditorModel&&(i.diffEditorModel.original.getValue()!==t.value[0]&&i.diffEditorModel.original.setValue(t.value[0]??""),i.diffEditorModel.modified.getValue()!==t.value[1]&&i.diffEditorModel.modified.setValue(t.value[1]??"")):i.model&&i.model.getValue()!==t.value&&i.model.setValue(t.value??"")),this.emit(o.onUpdateTab,t.id,e))})}saveTabs(t,e){t.forEach(s=>{this.updateTab({id:s,modified:!1},e)})}addToolbars(t){this.dispatch(e=>{e.toolbar.push(...t)})}updateToolbar(t){this.dispatch(e=>{const s=e.toolbar.find(n(t.id));s&&Object.assign(s,t)})}_close(t){this.dispatch(e=>{var l,g;const s={tabId:(l=this.getCurrentGroup())==null?void 0:l.activeTab,groupId:e.current},i=[];t.forEach(({tabId:a,groupId:u})=>{var C;const b=e.groups.findIndex(n(u)),h=e.groups[b],p=h.data.findIndex(n(a));if(p===-1)return;h.activeTab===a&&(h.activeTab=(C=T(h.data,p))==null?void 0:C.id);const[m]=h.data.splice(p,1);i.push(m)}),t.forEach(({groupId:a})=>{var h,p;const u=e.groups.findIndex(n(a));if(u===-1||e.groups[u].data.length)return;e.current===a&&(e.current=(h=T(e.groups,u))==null?void 0:h.id);const[b]=e.groups.splice(u,1);(p=b.editorInstance)==null||p.dispose()});let r=0;i.forEach(a=>{!a.model||e.groups.find(u=>u.data.find(b=>b.model===a.model))||(a.model.dispose(),r+=1)}),r>0&&this.keyboardFocus.recreateHiddenEditor(),this.emit(o.onClose,i);const c=(g=e.groups.find(n(e.current)))==null?void 0:g.activeTab;(e.current!==s.groupId||c!==s.tabId)&&this.emit(o.onCurrentChange,s,{tabId:c,groupId:e.current})})}closeTab(t,e){this._close([{tabId:t,groupId:e}])}closeOther(t,e){const i=this.getTabs(e).filter(r=>r.id!==t);this._close(i.map(r=>({tabId:r.id,groupId:e})))}closeToRight(t,e){const s=this.getTabs(e),i=s.slice(s.findIndex(n(t))+1);this._close(i.map(r=>({tabId:r.id,groupId:e})))}closeToLeft(t,e){const s=this.getTabs(e),i=s.slice(0,s.findIndex(n(t)));this._close(i.map(r=>({tabId:r.id,groupId:e})))}closeSaved(t){const s=this.getTabs(t).filter(i=>!i.modified);this._close(s.map(i=>({tabId:i.id,groupId:t})))}removeGroup(t){const e=this.getGroup(t);e&&this._close(e.data.map(s=>({tabId:s.id,groupId:t})))}closeAll(t){if(f(t)){const e=this.getGroups();this._close(e.reduce((s,i)=>(s.push(...i.data.map(r=>({tabId:r.id,groupId:i.id}))),s),[]))}else this.removeGroup(t)}moveTab(t,e){this.dispatch(s=>{var u;const i=s.groups.find(n(t.groupId)),r=s.groups.find(n(e.groupId));if(!i||!r)return;const c=i.data.findIndex(n(t.tabId)),l=r.data.findIndex(n(e.tabId));if(c===-1||l===-1)return;t.groupId!==e.groupId&&i.activeTab===t.tabId&&(i.activeTab=(u=T(i.data,c))==null?void 0:u.id);const g=i.data.splice(c,1),a=r.data.findIndex(n(t.tabId));if(a===-1?r.data.splice(l,0,g[0]):r.data.splice(l,0,r.data.splice(a,1)[0]),r.activeTab=t.tabId,!i.data.length){const b=s.groups.findIndex(n(t.groupId));s.groups.splice(b,1)}})}setCurrentGroup(t){var s;const e=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:e==null?void 0:e.activeTab,groupId:e==null?void 0:e.id},{tabId:(s=this.getGroup(t))==null?void 0:s.activeTab,groupId:t}),this.dispatch(i=>{i.current=t})}setCurrent(t,e){const s=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:s==null?void 0:s.activeTab,groupId:s==null?void 0:s.id},{tabId:t,groupId:e}),this.dispatch(i=>{i.current=e;const r=i.groups.find(n(e));r&&(r.activeTab=t)})}updateGroup(t){if(Object.hasOwn(t,"activeTab")){const e=this.getCurrentGroup();this.emit(o.onCurrentChange,{tabId:e==null?void 0:e.activeTab,groupId:e==null?void 0:e.id},{tabId:t.activeTab,groupId:t.id})}this.dispatch(e=>{const s=e.groups.find(n(t.id));s&&Object.assign(s,t)})}setLoading(t){this.dispatch(e=>{e.loading=typeof t=="function"?t(e.loading):t})}createGroup(t){return{...new M(`EDITOR_GROUP_${D()}`,[t],t.id)}}addGroup(t){this.dispatch(e=>{e.groups.push(this.createGroup(t))})}addTab(t,e){this.dispatch(s=>{const i=s.groups.find(n(e));i&&i.data.push(t)})}open(t,e){if(this.getGroup(e))this.addTab(t,e),this.setCurrent(t.id,e);else{this.addGroup(t);const s=this.getGroups().at(-1);s&&this.setCurrentGroup(s.id)}this.emit(o.onOpenTab,t)}onFocus(t){this.subscribe(o.onFocus,t)}onCursorSelection(t){this.subscribe(o.onCursorSelection,t)}onSelectTab(t){this.subscribe(o.onSelectTab,t)}onContextMenu(t){this.subscribe(o.onContextMenu,t)}onToolbarClick(t){this.subscribe(o.onToolbarClick,t)}onUpdateTab(t){this.subscribe(o.onUpdateTab,t)}onOpenTab(t){this.subscribe(o.onOpenTab,t)}onChange(t){this.subscribe(o.onChange,t)}onDragStart(t){this.subscribe(o.onDragStart,t)}onDragEnd(t){this.subscribe(o.onDragEnd,t)}onDragEnter(t){this.subscribe(o.onDragEnter,t)}onDragLeave(t){this.subscribe(o.onDragLeave,t)}onDragOver(t){this.subscribe(o.onDragOver,t)}onDrop(t){this.subscribe(o.onDrop,t)}onClose(t){this.subscribe(o.onClose,t)}onCloseAll(t){this.subscribe(o.onCloseAll,t)}onCloseTab(t){this.subscribe(o.onCloseTab,t)}onCloseOther(t){this.subscribe(o.onCloseOther,t)}onCloseToLeft(t){this.subscribe(o.onCloseToLeft,t)}onCloseToRight(t){this.subscribe(o.onCloseToRight,t)}onSplitEditorRight(t){this.subscribe(o.onSplitEditorRight,t)}onContextMenuClick(t){this.subscribe(o.onContextMenuClick,t)}onMount(t){this.subscribe(o.onMount,t)}onModelMount(t){this.subscribe(o.onModelMount,t)}onDiffEditorMount(t){this.subscribe(o.onDiffEditorMount,t)}onDiffEditorModelMount(t){this.subscribe(o.onDiffEditorModelMount,t)}onCurrentChange(t){this.subscribe(o.onCurrentChange,t)}};I=P([_(),R(0,S("keyboardFocus"))],I);export{I as EditorService};

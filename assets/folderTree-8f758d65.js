var b=Object.defineProperty;var f=(d,e,t)=>e in d?b(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var a=(d,e,t)=>(f(d,typeof e!="symbol"?e+"":e,t),t);import{B as x,N as p,T as h,O as u,s as y,P as r,i as v}from"./index-09b6a538.js";import{i as c}from"./isUndefined-aa0326a0.js";var C=Object.defineProperty,E=Object.getOwnPropertyDescriptor,w=(d,e,t,n)=>{for(var s=n>1?void 0:n?E(e,t):e,o=d.length-1,i;o>=0;o--)(i=d[o])&&(s=(n?i(e,t,s):i(s))||s);return n&&s&&C(e,t,s),s};let g=class extends x{constructor(){super("folderTree");a(this,"state");a(this,"onContextMenu",e=>{this.subscribe(r.onContextMenu,e)});a(this,"onExpand",e=>{this.subscribe(r.onExpand,e)});a(this,"onDragOver",e=>{this.subscribe(r.onDragOver,e)});a(this,"onDrop",e=>{this.subscribe(r.onDrop,e)});this.state=new p}addLoading(e){this.dispatch(t=>{t.loadingKeys.push(e)})}removeLoading(e){this.dispatch(t=>{if(c(e)){t.loadingKeys=[];return}const n=t.loadingKeys.indexOf(e);n!==-1&&t.loadingKeys.splice(n,1)})}get(e){return this.getState().data.length?new h(this.getState().data).getNode(e):void 0}getParentNode(e){return this.getState().data.length?new h(this.getState().data).getParent(e):void 0}addRootFolder(e){this.dispatch(t=>{var n;(n=t.data)!=null&&n.length||(t.data=[e])})}add(e,t){if(e.fileType===u.RootFolder){this.addRootFolder(e);return}if(c(t))throw new Error("File node or folder node both need id");this.dispatch(s=>{const i=new h(s.data).getNode(t);i&&(i.children??(i.children=[]),i.children.push(e))})}remove(e){this.dispatch(t=>{var i,l;const s=new h(t.data).getParent(e),o=(i=s==null?void 0:s.children)==null?void 0:i.findIndex(y(e));o===void 0||o===-1||(l=s==null?void 0:s.children)==null||l.splice(o,1)})}update(e,t){this.dispatch(n=>{const o=new h(n.data).getNode(typeof e=="object"?e.id:e);o&&Object.assign(o,typeof e=="object"?e:t==null?void 0:t(o))}),this.emit(r.onUpdate,this.get(typeof e=="object"?e.id:e))}drop(e,t){const n=this.get(e);if(!n)return;const s=this.get(t);!s||s.fileType===u.File||(this.remove(e),this.add(n,s.id))}setCurrent(e){this.emit(r.onCurrentChange,this.getCurrent(),e),this.dispatch(t=>{t.current=e})}getCurrent(){return this.getState().current}getExpanded(){return this.getState().expandedKeys}addExpanded(e){this.dispatch(t=>{t.expandedKeys.push(e)})}removeExpanded(e){this.dispatch(t=>{if(c(e)){t.expandedKeys=[];return}const n=t.expandedKeys.indexOf(e);n!==-1&&t.expandedKeys.splice(n,1)})}toggleExpanded(e){this.getExpanded().includes(e)?this.removeExpanded(e):this.addExpanded(e)}setValidateInfo(e){this.dispatch(t=>{t.validateInfo=typeof e=="string"?{status:"info",message:e}:e})}setEntry(e){this.dispatch(t=>{t.entry=e})}setEditing(e){this.dispatch(t=>{t.editing=e})}reset(){this.setState(new p)}onRename(e){this.subscribe(r.onRename,e)}onRemove(e){this.subscribe(r.onDelete,e)}onSelect(e){this.subscribe(r.onSelect,e)}onContextMenuClick(e){this.subscribe(r.onContextMenuClick,e)}onKeyDown(e){this.subscribe(r.onKeyDown,e)}onCreateRoot(e){this.subscribe(r.onCreateRoot,e)}onUpdate(e){this.subscribe(r.onUpdate,e)}onBlur(e){this.subscribe(r.onBlur,e)}onLoad(e){this.subscribe(r.onLoad,e)}onDragStart(e){this.subscribe(r.onDragStart,e)}onDragEnd(e){this.subscribe(r.onDragEnd,e)}onCurrentChange(e){this.subscribe(r.onCurrentChange,e)}};g=w([v()],g);export{g as FolderTreeService};
